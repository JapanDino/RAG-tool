# План разработки прототипа RAG-разметки по таксономии Блума

## 1. Краткое описание цели
Построить прототип, который принимает образовательный текст, выделяет смысловые узлы (концепты/цели), классифицирует их по уровням таксономии Блума (multi‑label), сохраняет в RAG‑совместимую базу и визуализирует результат в интерактивном графе знаний.

## 2. Что уже сделано в репозитории
**Бэкенд (FastAPI):**
- Реализована базовая модель данных для датасетов, документов, чанков, эмбеддингов и аннотаций Блума.  
- Есть эндпоинты для загрузки документов, простого чанкинга (по 800 символов), запуска индексации, экспорта данных и запуска аннотаций.  
- Реализован пайплайн задач (Celery) для индексации и аннотирования.  
- Есть поиск по эмбеддингам (SQL + pgvector) и выгрузка данных (JSONL/CSV/QTI/Moodle/ragpkg).  
- LLM‑аннотация предусмотрена, но по умолчанию используется эвристический fallback.

**Фронтенд (Next.js):**
- Минимальный UI для создания датасета, загрузки документа, запуска индексации и аннотации, просмотра статуса задач.

## 3. Оценка: что оставить, что заменить
**Оставить:**
- Базовую структуру БД (Dataset/Document/Chunk/Embedding/BloomAnnotation/Job). Это соответствует требованиям по хранению узлов и вероятностей.  
- Архитектуру фоновых задач (Celery) — удобно для асинхронной обработки.  
- Слой API (FastAPI) как точку интеграции с UI и внешними клиентами.  
- Механизм экспорта данных — пригодится для размеченного датасета.

**Требует замены/существенной доработки:**
- Чанкинг: сейчас простой разрез по длине. Нужен семантический chunking/NER.  
- Эмбеддинги: используются случайные векторы. Нужна реальная модель и валидный векторный стор.  
- Аннотация Блума: эвристика — только заглушка. Нужна multi‑label классификация с вероятностями.  
- UI: нет вкладок «Анализ контента» и «Граф знаний», нет визуализации графа.  
- Графовые связи: отсутствуют правила вычисления рёбер (семантическая близость/ко‑встречаемость).

## 4. План разработки (до полноценного прототипа)

### Этап 0. Уточнение требований и подготовка данных
**Цель:** зафиксировать критерии разметки и подготовить основу для обучения/оценки.  
**Задачи:**
1. Согласовать схему «узел знаний» (название, контекст, связь с фразой‑источником).  
2. Подготовить глоссарий глаголов/операций по Блуму (RU приоритет).  
3. Собрать минимум 100 размеченных примеров (текст → узлы → уровни).  
**Результат:** датасет, правила разметки, глоссарий.

### Этап 1. Семантическое выделение узлов (Chunking + NER)
**Цель:** заменить простое разбиение по длине на семантическое.  
**Задачи:**
1. Интегрировать NER‑модель (например, spaCy/DeepPavlov/ruBERT).  
2. Добавить семантический chunker, который выделяет: термины, концепты, объекты, навыки.  
3. Сохранить в БД не только текст чанка, но и тип сущности/роль (в meta).  
**Результат:** модуль узлов, дающий осмысленные чанки для графа.

### Этап 2. Мульти‑лейбл классификация по Блуму
**Цель:** получать вектор вероятностей по 6 уровням.  
**Задачи:**
1. Реализовать модель (baseline: zero‑shot LLM; затем fine‑tuned RU‑модель).  
2. Возвращать вектор вероятностей и сохранять в БД как массив/JSON.  
3. Добавить метрики качества (Hamming loss, F1 micro/macro).  
**Результат:** API, который дает multi‑label Bloom‑профиль.

### Этап 3. Эмбеддинги и векторная БД
**Цель:** обеспечить корректный поиск и хранение узлов.  
**Задачи:**
1. Встроить реальную модель эмбеддингов (sentence‑transformers / OpenAI / отечественные модели).  
2. Хранить эмбеддинги в pgvector или отдельном векторном сторе.  
3. Добавить versioning модели эмбеддингов.  
**Результат:** корректные векторы и семантический поиск.

### Этап 4. Формирование графа знаний
**Цель:** строить связи между узлами.  
**Задачи:**
1. Вычислять связь по семантической близости (cosine threshold).  
2. Добавить альтернативную связь по ко‑встречаемости в одном документе.  
3. Сохранить связи в отдельной таблице/графовой БД.  
**Результат:** вычислимые ребра и графовая структура.

### Этап 5. Визуализация и UI
**Цель:** реализовать вкладки и интерактивный граф.  
**Задачи:**
1. Вкладка «Анализ контента»: ввод текста, запуск, таблица узлов и Bloom‑профиля.  
2. Вкладка «Граф знаний»: интерактивная визуализация (например, Cytoscape/D3).  
3. Поддержка цветовой кодировки, градиента, фильтров и hover‑контекста.  
**Результат:** полноценный пользовательский интерфейс.

### Этап 6. Интеграция и тестирование
**Цель:** обеспечить цельный рабочий прототип.  
**Задачи:**
1. Сквозной сценарий: загрузка текста → узлы → Bloom‑профиль → граф.  
2. Прогон метрик качества на тестовом датасете.  
3. Документирование API и пользовательских сценариев.  
**Результат:** демонстрационный прототип + отчет о качестве.

### Этап 7. Материалы для защиты
**Цель:** оформить результаты.  
**Задачи:** пояснительная записка, презентация, демо‑пример, дамп БД, скриншоты.  
**Результат:** полный пакет материалов по ТЗ.

## 5. Итоговое соответствие ТЗ
После выполнения этапов выше система будет:
- выделять смысловые узлы,  
- классифицировать их по Блуму с вероятностями,  
- хранить в векторной БД,  
- визуализировать в виде интерактивного графа,  
что соответствует всем ключевым требованиям ТЗ.
